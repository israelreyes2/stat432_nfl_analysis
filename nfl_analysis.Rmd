---
title: "Can We Win?!"
author:
- Eric Jong Bum Kim (jekim3)
- Israel Reyes (ir2)
- Jihee Hwang (jhwang55)
- Hyun Suk Lee ()
date: "November 15, 2019"
output:
  html_document: default
  pdf_document: default
subtitle: STAT 432 FA2019 - Team LRHK
abstract: Coming Soon
---

\newpage 

# Introduction

NFL is one of the most-loved professional sport league in the United States. NFL is undoublety the top of the United States bringing in over $13 billion in Revenue every year. With that in mind, think about how much pressure each and every NFL players have on their shoulders during the game. They don't want to dissapoint their supporting fans, and coaches! Some say that American football is a chess game. Head coaches are the players of the chess game, and each NFL players are pieces which head coaches move to win the game. With that in mind, every head coaches' goal of each and every play they call, regardless on offense, defense, or speical team, they are looking to gain any sort of edge over their opponent. American football is quite differnt from other sports since after each play, game stops. After each play, coaches tell their players to run a play which will allow them to score. Head coaches call plays based on combination of experiences, time on clock, field positions, their team's best players, and more. What if, like other sports, analytics can call plays? 

In an attempt to construct a meaningful and effective way for head coaches to decide to call which play purely relying on analytics, various statistical learning technqiues will be applied to the NFL play-by-play data. The main goal of our model is to see if analytical variables at the moment of the game can increase the chance of team winning the most. In NFL, there is a measure called, winning percentage. Winning percentage measures probabiity of a team winning at the given moment of the game, and since football game stop after each play, winning percentage changes after each play. Can we possibly decide which play will increase team's chance of winning according to football analytics? 

# Background Information On Data 

The dataset originates from the Chicago Digital Hub [^2] and was accessed through Kaggle [^1]. The safety and quality of taxi rides in Chicago are guaranteed through BACP [^3] (Department of Business Affairs and Consumer Protection) where they are authorized to collect information on taxi rides. This data is reported periodically through two major payment processors in which not all trips are reported but is believed to cover most of the taxi rides in Chicago. Based on this data reporting process, the dataset contains over 100 million taxi rides in Chicago from 2013. 

Due to private concerns, following measures were implemented:

- Each trip appears with delay in the data, long after the completion of the ride
- The Taxi ID is consistent for a given taxi medallion number, but was created specifically for the dataset
- Location is provided only at the Census Tract [^4] and Community Area levels [^5]

Other corrections applied to the data include:

- Trip times less than zero or greater than 86,400 seconds are removed.
- Trip lengths less than zero or greater than 3,500 miles are removed.
- If any component of the trip cost is less than $0 or greater than $10,000, all components of the trip cost are removed.

# Data Description

The NFL data for each season contains 257 different variables in attempt to explain every play of the game in every game of the season. For the purpose of our project following will be done.

1. Our project will only consider 2018 NFL season. The Atlatna Falcons and philadelphia Eagles played season openr on 09/06/2018, and final games of the season were played on 12/30/2018. We decided to focus on single 2018 season because of size of the data, and trend of the NFL games are rapidly changing now days, that playing styles from two seasons ago are considered "outdated". 

2. With 257 variables, we had to narrow down our variables. There are many variables there are quite meaningless. Based on our prior knowledge of the game, we will narrow down to variables that we believe might be a variables that caoches can input during the game. These include variables such as field position, game clock, and team's quaterback. These variables are subject to change as the study goes further. 

3. In NFL there are 10 types of play a team can excute throughout the game. However, for our purpose of the study, we will remove following play types for following reasons: 

 - NA : these are game administrative play types such as end of the quarters, end of the regularation, and 2 minute warnings
 - qb_kneel : most of the time, QB will only kneel when the game result has already been decided and to run down the clock to the end of the game, so we will ignore these 
 - no_play : no_play represnts plays which penatly has occured. Further study will be needed in order to accruatly decide what we are going do with these plays. 

# Statistical Learning Task

That being said, the statistical learning task to accomplish this goal will be with the means of classification models. Given certain features of the dataset like the geographical location, the length of the trip, cost and many others we will be classifying the company that corresponding trip applies to. It is immediately apparent that binary classification models are out of the question unless we would like to target a specific company to make it the positive class meanwhile the others are grouped into another classification. The problem with this however is that could potentially make the dataset uneven and although there are methods to combat this problem, we would have to model depending how many unique companies are in the dataset. Multiclass classification would have to be the main method for our goal with use of K-Nearest Neighbors and Random Forests along with cross validation, where we will be using 2 metrics to maximize being accuracy and sensitivity. 

# Data Loading

```{r package loading}
library(dplyr)
library(tidyverse)
```

```{r data loading, warning = FALSE}
df_2018_first = read_csv("/cloud/project/NFL_2018_first.csv")
df_2018_second = read_csv("/cloud/project/NFL_2018_second.csv")
df_2018 = rbind(df_2018_first, df_2018_second)
```

```{r}
head(df_2018)
```

```{r}
unique(df_2018$game_date)
```


```{r cleaning up columns - temp}
keep = c("posteam", "defteam", "yardline_100", "game_date", "game_seconds_remaining", "qtr", "down", "ydstogo",
         "play_type", "yards_gained", 
         "pass_length", "air_yards", "yards_after_catch",
         "run_location", 
         "posteam_timeouts_remaining", "defteam_timeouts_remaining",
         "wpa", 
         "passer_player_name", "receiver_player_name", "rusher_player_name", "punter_player_name", "kicker_player_name"
         )

#These are variables that I might thought it would be useful for us to limit down to, feel free to add any as needed

df_2018_reduced = subset(df_2018, select = keep)
```

```{r}
unique(df_2018$play_type)
```

```{r, checking no_plays in play type}
#no_play = subset(df_2018, df_2018$play_type == "no_play")
#head(no_play)
```


```{r, removing adminstrative playtypes}
#game_warnings = sum(is.na(df_2018$play_type)) #all of the NA playtypes are either end of quaters or two-min warnings. (1429 of them)

df_2018_reduced = df_2018_reduced[complete.cases(df_2018_reduced[ , "play_type"]),]
```

# Data Modeling 

```{r initial_modeling}
lm_mod = lm(wpa ~  quarter_seconds_remaining + yards_gained + yards_after_catch, data = df_2018)
summary(lm_mod)
```







[^1]: [Chicago Taxi Trips Data](https://www.kaggle.com/chicago/chicago-taxi-trips-bq)

[^2]: [Digital Hub: Chicago Taxi Data Released](https://digital.cityofchicago.org/index.php/chicago-taxi-data-released/)

[^3]: [City of Chicago: BACP](https://www.chicago.gov/city/en/depts/bacp/provdrs/vehic.html)

[^4] : [Chicago Data Portal: Census Tracts](https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Census-Tracts-2010/5jrd-6zik)

[^5]: [Chicago Data Portal: Community Areas](https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6)
